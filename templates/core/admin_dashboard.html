{% extends 'base.html' %}
{% block content %}

<style>
    .dashboard-title { font-size: 28px; font-weight: bold; margin-bottom: 20px; }
    .dashboard-buttons .btn { margin-right: 10px; margin-bottom: 5px; }
    .dashboard-cards { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 25px; }
    .dashboard-cards .card {
        flex: 1; min-width: 250px; background-color: #f8f9fa; border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 15px; text-align: center;
    }
    .dashboard-cards .card h5 { margin-bottom: 10px; font-weight: 600; }
    .dashboard-cards .card p { font-size: 22px; font-weight: bold; color: #333; margin: 0; }
    table.table-sm th, table.table-sm td { font-size: 14px; }
    .section-title { margin-top: 40px; font-weight: bold; }
</style>

<div class="container mt-4">

    <h2 class="dashboard-title">Admin Dashboard</h2>

    <!-- EXPORT BUTTONS -->
    <div class="dashboard-buttons mb-4">
        <!-- Accounts -->
        <a href="{% url 'accounts:export_accounts_pdf' %}" class="btn btn-danger btn-sm">Accounts PDF</a>
        <a href="{% url 'accounts:export_accounts_csv' %}" class="btn btn-primary btn-sm">Accounts CSV</a>
        <!-- Savings -->
        <a href="{% url 'accounts:export_transactions_pdf' %}" class="btn btn-dark btn-sm">Savings PDF</a>
        <a href="{% url 'accounts:export_transactions_csv' %}" class="btn btn-secondary btn-sm">Savings CSV</a>
        <!-- Loans -->
        <a href="{% url 'reports:export_loans_csv' %}" class="btn btn-success btn-sm">Loans CSV</a>
        <a href="{% url 'reports:loan_performance_report' %}" class="btn btn-info btn-sm">Loan Reports</a>
        <!-- Staff -->
        <a href="{% url 'reports:staff_performance_report' %}" class="btn btn-warning btn-sm">Staff Reports</a>
        <!-- Financial -->
        <a href="{% url 'reports:export_financial_csv' %}" class="btn btn-primary btn-sm">Financial CSV</a>
        <a href="{% url 'reports:export_financial_pdf' %}" class="btn btn-danger btn-sm">Financial PDF</a>
        <a href="{% url 'reports:export_summary_pdf' %}" class="btn btn-secondary btn-sm">Summary PDF</a>
        <a href="{% url 'reports:export_profit_loss_pdf' %}" class="btn btn-dark btn-sm">Profit & Loss PDF</a>
    </div>

    <!-- DASHBOARD CARDS -->
    <div class="dashboard-cards">
        <div class="card">
            <h5>Total Clients</h5>
            <p>{{ accounts|length }}</p>
        </div>
        <div class="card">
            <h5>Total Loans</h5>
            <p>{{ loans|length }}</p>
        </div>
        <div class="card">
            <h5>Total Savings Balance</h5>
            <p>{{ total_balance }}</p>
        </div>
        <div class="card">
            <h5>Active Accounts</h5>
            <p>{{ active_accounts }}</p>
        </div>
        <div class="card">
            <h5>Pending Loan Applications</h5>
            <p>{{ pending_loans }}</p>
        </div>
        <div class="card">
            <h5>Defaulted Loans</h5>
            <p>{{ defaulted_loans }}</p>
        </div>
        <div class="card">
            <h5>Top Savers</h5>
            <p>{{ top_savers|length }}</p>
        </div>
    </div>

    <!-- QUICK ACTIONS -->
    <div class="mb-4">
        <h4>Quick Actions</h4>
        <a href="{% url 'accounts:account_create' %}" class="btn btn-outline-primary btn-sm">Create New Account</a>
        <a href="{% url 'loans:loan_application_create' %}" class="btn btn-outline-success btn-sm">Create Loan</a>
        <a href="{% url 'accounts:savings_deposit' %}" class="btn btn-outline-info btn-sm">Deposit Savings</a>
        <a href="{% url 'accounts:savings_withdrawal' %}" class="btn btn-outline-warning btn-sm">Withdraw Savings</a>
        <a href="{% url 'reports:loan_performance' %}" class="btn btn-outline-dark btn-sm">Loan Reports</a>
        <a href="{% url 'reports:financial_report' %}" class="btn btn-outline-secondary btn-sm">Financial Reports</a>
    </div>

    <!-- ACCOUNTS TABLE -->
    <h4 class="section-title">All Client Accounts</h4>
    <div class="table-responsive">
        <table class="table table-striped table-sm">
            <thead>
                <tr>
                    <th>Account</th>
                    <th>Name</th>
                    <th>Balance</th>
                    <th>Officer</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for acc in accounts %}
                <tr>
                    <td>{{ acc.account_number }}</td>
                    <td>{{ acc.full_account_name }}</td>
                    <td>{{ acc.savings_balance }}</td>
                    <td>{{ acc.loan_officer.username }}</td>
                    <td>
                        <a href="{% url 'accounts:account_detail' acc.pk %}" class="btn btn-sm btn-primary">View</a>
                        <a href="{% url 'accounts:account_edit' acc.pk %}" class="btn btn-sm btn-warning">Edit</a>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="5">No accounts found.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- LOANS TABLE -->
    <h4 class="section-title">Loans Overview</h4>
    <div class="table-responsive">
        <table class="table table-bordered table-sm">
            <thead>
                <tr>
                    <th>Client</th>
                    <th>Loan Amount</th>
                    <th>Status</th>
                    <th>Issued</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for loan in loans %}
                <tr>
                    <td>{{ loan.client_account.full_account_name }}</td>
                    <td>{{ loan.loan_amount }}</td>
                    <td>{{ loan.status }}</td>
                    <td>{{ loan.application_date }}</td>
                    <td>
                        <a href="{% url 'loans:loan_application_detail' loan.pk %}" class="btn btn-sm btn-primary">View</a>
                        <a href="{% url 'loans:loan_application_edit' loan.pk %}" class="btn btn-sm btn-warning">Edit</a>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="5">No loans found.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- SAVINGS TABLE -->
    <h4 class="section-title">Recent Savings Activity</h4>
    <div class="table-responsive">
        <table class="table table-hover table-sm">
            <thead>
                <tr>
                    <th>Account</th>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Date</th>
                    <th>Staff</th>
                </tr>
            </thead>
            <tbody>
                {% for tx in recent_savings %}
                <tr>
                    <td>{{ tx.client_account.account_number }}</td>
                    <td>{{ tx.transaction_type }}</td>
                    <td>{{ tx.amount }}</td>
                    <td>{{ tx.transaction_date }}</td>
                    <td>{{ tx.processed_by.username }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="5">No recent transactions.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- STAFF PERFORMANCE TABLE -->
    <h4 class="section-title">Staff Overview</h4>
    <div class="table-responsive">
        <table class="table table-hover table-sm">
            <thead>
                <tr>
                    <th>Staff</th>
                    <th>Loans Processed</th>
                    <th>Savings Processed</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in staff_users %}
                <tr>
                    <td>{{ user.username }}</td>
                    <td>{{ user.loans_count }}</td>
                    <td>{{ user.savings_count }}</td>
                    <td>
                        <a href="{% url 'reports:staff_performance_report' %}" class="btn btn-sm btn-primary">View</a>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="4">No staff data found.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

{% endblock %}
