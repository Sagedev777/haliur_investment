{% extends 'client_accounts/base.html' %}

{% block title %}Dashboard{% endblock %}

{% block page_title %}Dashboard{% endblock %}
{% block page_subtitle %}Welcome back, {{ request.user.username }}{% endblock %}

{% block page_actions %}
<div class="btn-group shadow-sm w-100 w-md-auto mb-3 mb-md-0">
    <a href="{% url 'accounts:account_create' %}" class="btn btn-primary">
        <i class="fas fa-user-plus me-2"></i>
        <span class="d-none d-md-inline">New Account</span>
        <span class="d-md-none">New</span>
    </a>
    <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown">
        <span class="visually-hidden">Toggle Dropdown</span>
    </button>
    <ul class="dropdown-menu dropdown-menu-end shadow">
        <li><a class="dropdown-item" href="{% url 'accounts:savings_deposit' %}"><i
                    class="fas fa-money-bill-wave me-2"></i>Deposit</a></li>
        <li><a class="dropdown-item" href="{% url 'accounts:savings_withdrawal' %}"><i
                    class="fas fa-wallet me-2"></i>Withdrawal</a></li>
        <li>
            <hr class="dropdown-divider">
        </li>
        <li><a class="dropdown-item" href="{% url 'accounts:reports_dashboard' %}"><i
                    class="fas fa-chart-bar me-2"></i>Reports</a></li>
    </ul>
</div>
{% endblock %}

{% block content %}
<style>
    /* Mobile-specific styles */
    @media (max-width: 768px) {
        .stat-card .h3 {
            font-size: 1.5rem !important;
        }
        .stat-card .stat-icon {
            display: none;
        }
        .card-header h6 {
            font-size: 0.9rem;
        }
        .table td, .table th {
            padding: 0.5rem;
            font-size: 0.85rem;
        }
        .quick-actions .btn {
            padding: 0.75rem !important;
        }
        .quick-actions .btn i {
            font-size: 1.25rem !important;
            margin-bottom: 0.25rem !important;
        }
    }
    
    @media (max-width: 576px) {
        .col-xl-3 {
            margin-bottom: 1rem;
        }
        .stat-card .h3 {
            font-size: 1.25rem !important;
        }
        .text-xs {
            font-size: 0.7rem !important;
        }
        .quick-actions .col-md-6 {
            margin-bottom: 0.5rem;
        }
    }
</style>

<div class="row mb-4">
    <!-- Statistics Cards -->
    <div class="col-xxl-3 col-xl-4 col-md-6 col-12 mb-4">
        <div class="card stat-card border-start-primary border-start-4 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <div class="text-xs fw-bold text-primary text-uppercase mb-1">
                            Total Clients</div>
                        <div class="h3 mb-2 fw-bold text-gray-800">{{ total_accounts }}</div>
                        <div class="mb-0 text-muted text-xs">
                            <span class="text-success me-2">
                                <i class="fas fa-arrow-up me-1"></i> {{ active_accounts }} Active
                            </span>
                        </div>
                    </div>
                    <div class="stat-icon d-none d-md-block">
                        <i class="fas fa-users fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-transparent border-0 py-2">
                <small class="text-muted">
                    <i class="fas fa-history me-1"></i> Updated just now
                </small>
            </div>
        </div>
    </div>

    <div class="col-xxl-3 col-xl-4 col-md-6 col-12 mb-4">
        <div class="card stat-card border-start-success border-start-4 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <div class="text-xs fw-bold text-success text-uppercase mb-1">
                            Total Savings</div>
                        <div class="h3 mb-2 fw-bold text-gray-800">UGX {{ total_savings|floatformat:0 }}</div>
                        <div class="mb-0 text-muted text-xs">
                            <i class="fas fa-piggy-bank me-1"></i> Combined savings balance
                        </div>
                    </div>
                    <div class="stat-icon d-none d-md-block">
                        <i class="fas fa-piggy-bank fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-transparent border-0 py-2">
                <small class="text-muted">
                    <i class="fas fa-chart-line me-1"></i> All accounts
                </small>
            </div>
        </div>
    </div>

    <div class="col-xxl-3 col-xl-4 col-md-6 col-12 mb-4">
        <div class="card stat-card border-start-warning border-start-4 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <div class="text-xs fw-bold text-warning text-uppercase mb-1">
                            Pending Loans</div>
                        <div class="h3 mb-2 fw-bold text-gray-800">{{ recent_loans.count }}</div>
                        <div class="mb-0 text-muted text-xs">
                            <i class="fas fa-clock me-1"></i> Awaiting approval
                        </div>
                    </div>
                    <div class="stat-icon d-none d-md-block">
                        <i class="fas fa-hand-holding-usd fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-transparent border-0 py-2">
                <small class="text-muted">
                    <i class="fas fa-exclamation-circle me-1"></i> Requires attention
                </small>
            </div>
        </div>
    </div>

    <div class="col-xxl-3 col-xl-4 col-md-6 col-12 mb-4">
        <div class="card stat-card border-start-info border-start-4 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <div class="text-xs fw-bold text-info text-uppercase mb-1">
                            Today's Transactions</div>
                        <div class="h3 mb-2 fw-bold text-gray-800">{{ recent_savings.count }}</div>
                        <div class="mb-0 text-muted text-xs">
                            <i class="fas fa-exchange-alt me-1"></i> Recent savings activity
                        </div>
                    </div>
                    <div class="stat-icon d-none d-md-block">
                        <i class="fas fa-exchange-alt fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-transparent border-0 py-2">
                <small class="text-muted">
                    <i class="fas fa-calendar-day me-1"></i> {% now "F d" %}
                </small>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <!-- Recent Clients -->
    <div class="col-xl-6 col-12 mb-4">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-0 py-3 d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                <h6 class="m-0 fw-bold text-primary mb-2 mb-md-0">
                    <i class="fas fa-users me-2"></i>Recent Client Accounts
                </h6>
                <a href="{% url 'accounts:account_list' %}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-eye me-1"></i> 
                    <span class="d-none d-sm-inline">View All</span>
                    <span class="d-sm-none">All</span>
                </a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="border-0 ps-3 ps-md-4">Account No.</th>
                                <th class="border-0 d-none d-sm-table-cell">Name</th>
                                <th class="border-0 d-none d-md-table-cell">Type</th>
                                <th class="border-0 pe-3 pe-md-4">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for account in recent_accounts %}
                            <tr>
                                <td class="ps-3 ps-md-4 fw-semibold">
                                    <span class="d-sm-none">{{ account.account_number|slice:"-4:" }}</span>
                                    <span class="d-none d-sm-inline">{{ account.account_number }}</span>
                                </td>
                                <td class="d-none d-sm-table-cell">{{ account.full_account_name|truncatechars:20 }}</td>
                                <td class="d-none d-md-table-cell">{{ account.get_account_type_display }}</td>
                                <td class="pe-3 pe-md-4">
                                    {% if account.account_status == "ACTIVE" %}
                                    <span
                                        class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25">Active</span>
                                    {% elif account.account_status == "PENDING" %}
                                    <span
                                        class="badge bg-warning bg-opacity-10 text-warning border border-warning border-opacity-25">Pending</span>
                                    {% else %}
                                    <span class="badge bg-secondary">{{ account.account_status }}</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center py-5 text-muted">
                                    <i class="fas fa-users fa-2x mb-3 d-block opacity-50"></i>
                                    No recent accounts
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Transactions -->
    <div class="col-xl-6 col-12 mb-4">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-0 py-3 d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                <h6 class="m-0 fw-bold text-primary mb-2 mb-md-0">
                    <i class="fas fa-exchange-alt me-2"></i>Recent Savings Transactions
                </h6>
                <a href="{% url 'accounts:savings_list' %}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-eye me-1"></i>
                    <span class="d-none d-sm-inline">View All</span>
                    <span class="d-sm-none">All</span>
                </a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="border-0 ps-3 ps-md-4 d-none d-sm-table-cell">Account</th>
                                <th class="border-0">Type</th>
                                <th class="border-0">Amount</th>
                                <th class="border-0 pe-3 pe-md-4">Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transaction in recent_savings %}
                            <tr>
                                <td class="ps-3 ps-md-4 fw-semibold d-none d-sm-table-cell">
                                    {{ transaction.client_account.account_number }}
                                </td>
                                <td>
                                    {% if transaction.transaction_type == "DEPOSIT" %}
                                    <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25">
                                        <span class="d-none d-sm-inline">Deposit</span>
                                        <span class="d-sm-none">D</span>
                                    </span>
                                    {% else %}
                                    <span class="badge bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25">
                                        <span class="d-none d-sm-inline">Withdrawal</span>
                                        <span class="d-sm-none">W</span>
                                    </span>
                                    {% endif %}
                                </td>
                                <td class="fw-bold">UGX {{ transaction.amount|floatformat:0 }}</td>
                                <td class="pe-3 pe-md-4 text-muted">
                                    <span class="d-none d-md-inline">{{ transaction.transaction_date|date:"M d, H:i" }}</span>
                                    <span class="d-md-none">{{ transaction.transaction_date|date:"m/d H:i" }}</span>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center py-5 text-muted">
                                    <i class="fas fa-exchange-alt fa-2x mb-3 d-block opacity-50"></i>
                                    No recent transactions
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Quick Actions -->
    <div class="col-lg-6 col-12 mb-4">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-0 py-3">
                <h6 class="m-0 fw-bold text-primary">
                    <i class="fas fa-bolt me-2"></i>Quick Actions
                </h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-sm-6 col-12">
                        <a href="{% url 'accounts:account_create' %}"
                            class="btn btn-primary w-100 p-2 p-md-3 d-flex flex-column align-items-center shadow-sm hover-effect">
                            <i class="fas fa-user-plus fa-lg fa-2x-md mb-2"></i>
                            <span class="fw-semibold text-center">
                                <span class="d-none d-md-inline">New Client Account</span>
                                <span class="d-md-none">New Client</span>
                            </span>
                            <small class="text-white text-opacity-75 mt-1 text-center">
                                <span class="d-none d-md-inline">Register new client</span>
                                <span class="d-md-none">Register</span>
                            </small>
                        </a>
                    </div>
                    <div class="col-sm-6 col-12">
                        <a href="{% url 'accounts:savings_deposit' %}"
                            class="btn btn-success w-100 p-2 p-md-3 d-flex flex-column align-items-center shadow-sm hover-effect">
                            <i class="fas fa-money-bill-wave fa-lg fa-2x-md mb-2"></i>
                            <span class="fw-semibold text-center">
                                <span class="d-none d-md-inline">Savings Deposit</span>
                                <span class="d-md-none">Deposit</span>
                            </span>
                            <small class="text-white text-opacity-75 mt-1 text-center">
                                <span class="d-none d-md-inline">Add funds to account</span>
                                <span class="d-md-none">Add funds</span>
                            </small>
                        </a>
                    </div>
                    <div class="col-sm-6 col-12">
                        <a href="{% url 'accounts:savings_withdrawal' %}"
                            class="btn btn-warning w-100 p-2 p-md-3 d-flex flex-column align-items-center shadow-sm hover-effect">
                            <i class="fas fa-wallet fa-lg fa-2x-md mb-2"></i>
                            <span class="fw-semibold text-center">
                                <span class="d-none d-md-inline">Savings Withdrawal</span>
                                <span class="d-md-none">Withdrawal</span>
                            </span>
                            <small class="text-white text-opacity-75 mt-1 text-center">
                                <span class="d-none d-md-inline">Withdraw from account</span>
                                <span class="d-md-none">Withdraw</span>
                            </small>
                        </a>
                    </div>
                    <div class="col-sm-6 col-12">
                        <a href="{% url 'accounts:reports_dashboard' %}"
                            class="btn btn-info w-100 p-2 p-md-3 d-flex flex-column align-items-center shadow-sm hover-effect">
                            <i class="fas fa-chart-bar fa-lg fa-2x-md mb-2"></i>
                            <span class="fw-semibold text-center">
                                <span class="d-none d-md-inline">Generate Reports</span>
                                <span class="d-md-none">Reports</span>
                            </span>
                            <small class="text-white text-opacity-75 mt-1 text-center">
                                <span class="d-none d-md-inline">View analytics & reports</span>
                                <span class="d-md-none">Analytics</span>
                            </small>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Information -->
    <div class="col-lg-6 col-12 mb-4">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-0 py-3">
                <h6 class="m-0 fw-bold text-primary">
                    <i class="fas fa-info-circle me-2"></i>System Information
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-sm-6 col-12">
                        <div class="mb-4">
                            <small class="text-muted d-block mb-1">
                                <i class="fas fa-user me-1"></i> Logged in as
                            </small>
                            <strong class="d-block text-truncate">{{ request.user.first_name }} {{ request.user.last_name }}</strong>
                        </div>
                        <div class="mb-4">
                            <small class="text-muted d-block mb-1">
                                <i class="fas fa-sign-in-alt me-1"></i> Last Login
                            </small>
                            <strong>{{ request.user.last_login|date:"M d, Y H:i"|default:"Never" }}</strong>
                        </div>
                    </div>
                    <div class="col-sm-6 col-12">
                        <div class="mb-4">
                            <small class="text-muted d-block mb-1">
                                <i class="fas fa-calendar me-1"></i> Current Date
                            </small>
                            <strong>{% now "F d, Y" %}</strong>
                        </div>
                        <div class="mb-4">
                            <small class="text-muted d-block mb-1">
                                <i class="fas fa-clock me-1"></i> Current Time
                            </small>
                            <strong>{% now "H:i" %}</strong>
                        </div>
                    </div>
                </div>
                <hr class="my-3">
                <div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center mb-3">
                    <div class="mb-2 mb-sm-0">
                        <span class="text-muted">System Status:</span>
                        <span class="ms-2 fw-semibold">Operational</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <span class="me-2 text-success">
                            <i class="fas fa-circle fa-xs"></i>
                        </span>
                        <span
                            class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25">
                            <span class="d-none d-sm-inline">All Systems OK</span>
                            <span class="d-sm-none">OK</span>
                        </span>
                    </div>
                </div>
                <div class="mt-3">
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 95%" aria-valuenow="95"
                            aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <small class="text-muted mt-1 d-block">System performance: 95%</small>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Add animation to stat cards
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
            card.classList.add('animate__animated', 'animate__fadeInUp');
        });

        // Update current time every minute
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });

            // Update all time elements
            const timeElements = document.querySelectorAll('strong');
            timeElements.forEach(el => {
                if (el.textContent.match(/^\d{2}:\d{2}$/)) {
                    el.textContent = timeString;
                }
            });
        }

        // Update time every minute
        setInterval(updateCurrentTime, 60000);
    });
</script>
{% endblock %}