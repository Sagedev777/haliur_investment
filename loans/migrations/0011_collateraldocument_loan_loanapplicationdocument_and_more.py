import datetime
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone

class Migration(migrations.Migration):
    dependencies = [migrations.swappable_dependency(settings.AUTH_USER_MODEL), ('client_accounts', '0007_alter_clientaccount_created_by'), ('loans', '0010_alter_loanproduct_number_of_installments')]
    operations = [migrations.CreateModel(name='CollateralDocument', fields=[('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')), ('file', models.FileField(upload_to='collaterals/'))]), migrations.CreateModel(name='Loan', fields=[('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')), ('loan_number', models.CharField(max_length=50, unique=True)), ('principal_amount', models.DecimalField(decimal_places=2, max_digits=15)), ('interest_rate', models.DecimalField(decimal_places=2, max_digits=6)), ('term_days', models.IntegerField()), ('disbursement_date', models.DateField(blank=True, null=True)), ('maturity_date', models.DateField(blank=True, null=True)), ('first_payment_date', models.DateField(blank=True, null=True)), ('next_payment_date', models.DateField(blank=True, null=True)), ('total_interest_amount', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('total_repayment_amount', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('processing_fee_amount', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('late_fee_amount', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('remaining_balance', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('total_paid_amount', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('overdue_amount', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('days_overdue', models.IntegerField(default=0)), ('status', models.CharField(choices=[('PENDING_DISBURSEMENT', 'Pending Disbursement'), ('ACTIVE', 'Active'), ('OVERDUE', 'Overdue'), ('DEFAULTED', 'Defaulted'), ('CLOSED', 'Closed'), ('WRITTEN_OFF', 'Written Off')], default='PENDING_DISBURSEMENT', max_length=25)), ('created_at', models.DateTimeField(auto_now_add=True)), ('updated_at', models.DateTimeField(auto_now=True)), ('closed_at', models.DateTimeField(blank=True, null=True))], options={'ordering': ['-disbursement_date']}), migrations.CreateModel(name='LoanApplicationDocument', fields=[('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')), ('document', models.FileField(upload_to='loan_collateral/')), ('uploaded_at', models.DateTimeField(auto_now_add=True))]), migrations.CreateModel(name='LoanRepaymentSchedule', fields=[('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')), ('installment_number', models.IntegerField()), ('due_date', models.DateField()), ('principal_amount', models.DecimalField(decimal_places=2, max_digits=15)), ('interest_amount', models.DecimalField(decimal_places=2, max_digits=15)), ('total_amount', models.DecimalField(decimal_places=2, max_digits=15)), ('paid_principal', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('paid_interest', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('paid_late_fee', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('total_paid', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('status', models.CharField(choices=[('PENDING', 'Pending'), ('DUE', 'Due'), ('PARTIALLY_PAID', 'Partially Paid'), ('PAID', 'Paid'), ('OVERDUE', 'Overdue')], default='PENDING', max_length=20)), ('payment_date', models.DateField(blank=True, null=True)), ('late_fee_applied', models.BooleanField(default=False)), ('late_fee_amount', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('grace_period_days', models.IntegerField(default=5))], options={'ordering': ['installment_number']}), migrations.CreateModel(name='LoanTransaction', fields=[('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')), ('transaction_id', models.CharField(editable=False, max_length=50, unique=True)), ('reference_number', models.CharField(blank=True, max_length=100)), ('transaction_type', models.CharField(choices=[('DISBURSEMENT', 'Loan Disbursement'), ('PRINCIPAL_PAYMENT', 'Principal Payment'), ('INTEREST_PAYMENT', 'Interest Payment'), ('LATE_FEE_PAYMENT', 'Late Fee Payment'), ('EARLY_REPAYMENT', 'Early Repayment'), ('PENALTY_CHARGE', 'Penalty Charge'), ('ADJUSTMENT', 'Adjustment'), ('WRITE_OFF', 'Write Off')], max_length=25)), ('payment_method', models.CharField(choices=[('CASH', 'Cash'), ('BANK_TRANSFER', 'Bank Transfer'), ('MOBILE_MONEY', 'Mobile Money'), ('CHEQUE', 'Cheque'), ('AUTO_DEBIT', 'Auto Debit'), ('OFFSET', 'Savings Offset')], max_length=20)), ('amount', models.DecimalField(decimal_places=2, max_digits=15)), ('principal_amount', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('interest_amount', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('fee_amount', models.DecimalField(decimal_places=2, default=0, max_digits=15)), ('transaction_date', models.DateTimeField(default=datetime.datetime.now)), ('value_date', models.DateField(default=datetime.date.today)), ('is_reversed', models.BooleanField(default=False)), ('reversal_reason', models.TextField(blank=True)), ('reversal_date', models.DateTimeField(blank=True, null=True)), ('notes', models.TextField(blank=True)), ('attachment', models.FileField(blank=True, null=True, upload_to='loan_transactions/')), ('created_at', models.DateTimeField(auto_now_add=True)), ('updated_at', models.DateTimeField(auto_now=True))], options={'ordering': ['-transaction_date']}), migrations.AlterModelOptions(name='loanapplication', options={'ordering': ['-application_date']}), migrations.AlterModelOptions(name='loanpayment', options={'ordering': ['-payment_date']}), migrations.RenameField(model_name='guarantor', old_name='external_address', new_name='address'), migrations.RenameField(model_name='guarantor', old_name='external_name', new_name='contact_person'), migrations.RenameField(model_name='guarantor', old_name='external_contact', new_name='phone_number'), migrations.RenameField(model_name='loanapplication', old_name='disbursement_notes', new_name='approval_conditions'), migrations.RenameField(model_name='loanapplication', old_name='disbursement_date', new_name='review_date'), migrations.RenameField(model_name='loanapplication', old_name='due_date', new_name='submitted_date'), migrations.RemoveField(model_name='guarantor', name='external_nin'), migrations.RemoveField(model_name='guarantor', name='internal_customer'), migrations.RemoveField(model_name='loanapplication', name='client_account'), migrations.RemoveField(model_name='loanapplication', name='collateral_images'), migrations.RemoveField(model_name='loanapplication', name='disbursed_amount'), migrations.RemoveField(model_name='loanapplication', name='disbursed_by'), migrations.RemoveField(model_name='loanapplication', name='guarantor'), migrations.RemoveField(model_name='loanapplication', name='interest_amount'), migrations.RemoveField(model_name='loanapplication', name='loan_amount'), migrations.RemoveField(model_name='loanapplication', name='payment_mode'), migrations.RemoveField(model_name='loanapplication', name='total_amount'), migrations.RemoveField(model_name='loanapplication', name='transaction_reference'), migrations.RemoveField(model_name='loanpayment', name='loan_application'), migrations.RemoveField(model_name='loanpayment', name='notes'), migrations.RemoveField(model_name='loanpayment', name='payment_amount'), migrations.RemoveField(model_name='loanpayment', name='payment_method'), migrations.RemoveField(model_name='loanpayment', name='received_by'), migrations.RemoveField(model_name='loanpayment', name='transaction_reference'), migrations.RemoveField(model_name='loanproduct', name='interest_method'), migrations.RemoveField(model_name='loanproduct', name='interest_rate'), migrations.RemoveField(model_name='loanproduct', name='loan_period'), migrations.RemoveField(model_name='loanproduct', name='max_amount'), migrations.RemoveField(model_name='loanproduct', name='min_amount'), migrations.RemoveField(model_name='loanproduct', name='number_of_installments'), migrations.AddField(model_name='guarantor', name='company_name', field=models.CharField(blank=True, max_length=200)), migrations.AddField(model_name='guarantor', name='created_at', field=models.DateTimeField(auto_now_add=True, default=django.utils.timezone.now), preserve_default=False), migrations.AddField(model_name='guarantor', name='created_by', field=models.ForeignKey(default=1, on_delete=django.db.models.deletion.PROTECT, related_name='guarantors_created', to=settings.AUTH_USER_MODEL), preserve_default=False), migrations.AddField(model_name='guarantor', name='email', field=models.EmailField(blank=True, max_length=254)), migrations.AddField(model_name='guarantor', name='guarantee_amount', field=models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)), migrations.AddField(model_name='guarantor', name='guarantee_percent', field=models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)), migrations.AddField(model_name='guarantor', name='guarantor_id', field=models.CharField(default='GTR-TEMP-001', editable=False, max_length=50, unique=True), preserve_default=False), migrations.AddField(model_name='guarantor', name='id_document', field=models.FileField(blank=True, null=True, upload_to='guarantor_ids/')), migrations.AddField(model_name='guarantor', name='individual', field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='guarantor_for', to='client_accounts.clientaccount')), migrations.AddField(model_name='guarantor', name='is_active', field=models.BooleanField(default=True)), migrations.AddField(model_name='guarantor', name='nin', field=models.CharField(blank=True, max_length=50)), migrations.AddField(model_name='guarantor', name='registration_number', field=models.CharField(blank=True, max_length=100)), migrations.AddField(model_name='guarantor', name='signed_agreement', field=models.FileField(blank=True, null=True, upload_to='guarantor_agreements/')), migrations.AddField(model_name='guarantor', name='updated_at', field=models.DateTimeField(auto_now=True)), migrations.AddField(model_name='guarantor', name='verification_date', field=models.DateField(blank=True, null=True)), migrations.AddField(model_name='guarantor', name='verified', field=models.BooleanField(default=False)), migrations.AddField(model_name='guarantor', name='verified_by', field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='guarantors_verified', to=settings.AUTH_USER_MODEL)), migrations.AddField(model_name='loanapplication', name='application_id', field=models.CharField(default='APP-TEMP-001', editable=False, max_length=20, unique=True), preserve_default=False), migrations.AddField(model_name='loanapplication', name='approved_amount', field=models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)), migrations.AddField(model_name='loanapplication', name='approved_interest_rate', field=models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True)), migrations.AddField(model_name='loanapplication', name='approved_term_days', field=models.IntegerField(blank=True, null=True)), migrations.AddField(model_name='loanapplication', name='client', field=models.ForeignKey(default=1, on_delete=django.db.models.deletion.PROTECT, related_name='loan_applications', to='client_accounts.clientaccount'), preserve_default=False), migrations.AddField(model_name='loanapplication', name='collateral_documents', field=models.FileField(blank=True, null=True, upload_to='loan_docs/')), migrations.AddField(model_name='loanapplication', name='created_at', field=models.DateTimeField(auto_now_add=True, default=django.utils.timezone.now), preserve_default=False), migrations.AddField(model_name='loanapplication', name='created_by', field=models.ForeignKey(default=1, on_delete=django.db.models.deletion.PROTECT, related_name='created_applications', to=settings.AUTH_USER_MODEL), preserve_default=False), migrations.AddField(model_name='loanapplication', name='credit_score', field=models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)), migrations.AddField(model_name='loanapplication', name='guarantors', field=models.ManyToManyField(blank=True, to='loans.guarantor')), migrations.AddField(model_name='loanapplication', name='net_disbursement_amount', field=models.DecimalField(decimal_places=2, default=0, max_digits=15)), migrations.AddField(model_name='loanapplication', name='processing_fee_amount', field=models.DecimalField(decimal_places=2, default=0, max_digits=15)), migrations.AddField(model_name='loanapplication', name='purpose', field=models.TextField(default='Unknown'), preserve_default=False), migrations.AddField(model_name='loanapplication', name='requested_amount', field=models.DecimalField(decimal_places=2, default=100000, max_digits=15), preserve_default=False), migrations.AddField(model_name='loanapplication', name='requested_term_days', field=models.IntegerField(default=30), preserve_default=False), migrations.AddField(model_name='loanapplication', name='reviewed_by', field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reviewed_applications', to=settings.AUTH_USER_MODEL)), migrations.AddField(model_name='loanapplication', name='risk_rating', field=models.CharField(blank=True, choices=[('A', 'Low Risk'), ('B', 'Medium Risk'), ('C', 'High Risk'), ('D', 'Very High Risk')], max_length=1, null=True)), migrations.AddField(model_name='loanapplication', name='total_interest_amount', field=models.DecimalField(decimal_places=2, default=0, max_digits=15)), migrations.AddField(model_name='loanapplication', name='total_repayment_amount', field=models.DecimalField(decimal_places=2, default=0, max_digits=15)), migrations.AddField(model_name='loanapplication', name='updated_at', field=models.DateTimeField(auto_now=True)), migrations.AddField(model_name='loanpayment', name='amount', field=models.DecimalField(decimal_places=2, default=0, max_digits=15), preserve_default=False), migrations.AddField(model_name='loanpayment', name='created_at', field=models.DateTimeField(auto_now_add=True, default=django.utils.timezone.now), preserve_default=False), migrations.AddField(model_name='loanpayment', name='interest_amount', field=models.DecimalField(decimal_places=2, default=0, max_digits=15)), migrations.AddField(model_name='loanpayment', name='late_fee_amount', field=models.DecimalField(decimal_places=2, default=0, max_digits=15)), migrations.AddField(model_name='loanpayment', name='principal_amount', field=models.DecimalField(decimal_places=2, default=0, max_digits=15)), migrations.AddField(model_name='loanpayment', name='status', field=models.CharField(choices=[('PENDING', 'Pending'), ('PARTIAL', 'Partially Paid'), ('PAID', 'Fully Paid')], default='PENDING', max_length=10)), migrations.AddField(model_name='loanpayment', name='updated_at', field=models.DateTimeField(auto_now=True)), migrations.AddField(model_name='loanproduct', name='annual_interest_rate', field=models.DecimalField(decimal_places=2, default=25, help_text='Annual Percentage Rate (%)', max_digits=6), preserve_default=False), migrations.AddField(model_name='loanproduct', name='code', field=models.CharField(default='PROD-001', max_length=20, unique=True), preserve_default=False), migrations.AddField(model_name='loanproduct', name='created_by', field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)), migrations.AddField(model_name='loanproduct', name='early_repayment_penalty_percent', field=models.DecimalField(decimal_places=2, default=Decimal('2.00'), max_digits=5)), migrations.AddField(model_name='loanproduct', name='interest_calculation_method', field=models.CharField(choices=[('ACTUAL_365', 'Actual/365 Fixed'), ('ACTUAL_360', 'Actual/360'), ('30_360', '30/360')], default='ACTUAL_365', max_length=20)), migrations.AddField(model_name='loanproduct', name='interest_type', field=models.CharField(choices=[('FLAT', 'Flat Rate (Simple Interest)'), ('REDUCING_MONTHLY', 'Reducing Balance (Monthly Rest)'), ('REDUCING_DAILY', 'Reducing Balance (Daily Rest)')], default='FLAT', max_length=20)), migrations.AddField(model_name='loanproduct', name='late_payment_fee_percent', field=models.DecimalField(decimal_places=2, default=Decimal('5.00'), max_digits=5)), migrations.AddField(model_name='loanproduct', name='max_loan_amount', field=models.DecimalField(decimal_places=2, default=Decimal('1000000.00'), max_digits=15)), migrations.AddField(model_name='loanproduct', name='max_term_days', field=models.IntegerField(default=365)), migrations.AddField(model_name='loanproduct', name='min_client_age_days', field=models.IntegerField(default=90, help_text='Minimum days as client')), migrations.AddField(model_name='loanproduct', name='min_loan_amount', field=models.DecimalField(decimal_places=2, default=Decimal('1000.00'), max_digits=15)), migrations.AddField(model_name='loanproduct', name='min_savings_balance_percent', field=models.DecimalField(decimal_places=2, default=Decimal('20.00'), help_text='Minimum savings balance as % of loan', max_digits=5)), migrations.AddField(model_name='loanproduct', name='min_term_days', field=models.IntegerField(default=7)), migrations.AddField(model_name='loanproduct', name='processing_fee_percent', field=models.DecimalField(decimal_places=2, default=Decimal('1.00'), max_digits=5)), migrations.AlterField(model_name='guarantor', name='guarantor_type', field=models.CharField(choices=[('INDIVIDUAL', 'Individual'), ('COMPANY', 'Company'), ('GROUP', 'Group')], max_length=20)), migrations.AlterField(model_name='loanapplication', name='application_number', field=models.CharField(max_length=50, unique=True)), migrations.AlterField(model_name='loanapplication', name='approved_by', field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_applications', to=settings.AUTH_USER_MODEL)), migrations.AlterField(model_name='loanapplication', name='collateral_description', field=models.TextField(blank=True)), migrations.AlterField(model_name='loanapplication', name='collateral_value', field=models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)), migrations.AlterField(model_name='loanapplication', name='loan_officer', field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='assigned_applications', to=settings.AUTH_USER_MODEL)), migrations.AlterField(model_name='loanapplication', name='loan_product', field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='loans.loanproduct')), migrations.AlterField(model_name='loanapplication', name='status', field=models.CharField(choices=[('DRAFT', 'Draft'), ('SUBMITTED', 'Submitted'), ('UNDER_REVIEW', 'Under Review'), ('APPROVED', 'Approved'), ('CONDITIONALLY_APPROVED', 'Conditionally Approved'), ('REJECTED', 'Rejected'), ('CANCELLED', 'Cancelled')], default='DRAFT', max_length=25)), migrations.AddIndex(model_name='loanapplication', index=models.Index(fields=['status', 'application_date'], name='loans_loana_status_ff64d3_idx')), migrations.AddIndex(model_name='loanapplication', index=models.Index(fields=['client', 'status'], name='loans_loana_client__5e42a5_idx')), migrations.AddField(model_name='loantransaction', name='installment', field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='payments', to='loans.loanrepaymentschedule')), migrations.AddField(model_name='loantransaction', name='loan', field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='transactions', to='loans.loan')), migrations.AddField(model_name='loantransaction', name='recorded_by', field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL)), migrations.AddField(model_name='loantransaction', name='verified_by', field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_transactions', to=settings.AUTH_USER_MODEL)), migrations.AddField(model_name='loanrepaymentschedule', name='loan', field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='repayment_schedule', to='loans.loan')), migrations.AddField(model_name='loanapplicationdocument', name='loan_application', field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='loans.loanapplication')), migrations.AddField(model_name='loan', name='application', field=models.OneToOneField(on_delete=django.db.models.deletion.PROTECT, related_name='loan', to='loans.loanapplication')), migrations.AddField(model_name='loan', name='client', field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='loans', to='client_accounts.clientaccount')), migrations.AddField(model_name='loan', name='disbursed_by', field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='disbursed_loans', to=settings.AUTH_USER_MODEL)), migrations.AddField(model_name='loan', name='loan_officer', field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='managed_loans', to=settings.AUTH_USER_MODEL)), migrations.AddField(model_name='loan', name='loan_product', field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='loans.loanproduct')), migrations.AddField(model_name='collateraldocument', name='loan_application', field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='collateral_docs', to='loans.loanapplication')), migrations.AddField(model_name='loanpayment', name='installment', field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='loans.loanrepaymentschedule')), migrations.AddField(model_name='loanpayment', name='loan', field=models.ForeignKey(default=1, on_delete=django.db.models.deletion.CASCADE, related_name='payments', to='loans.loan'), preserve_default=False), migrations.AddField(model_name='loanpayment', name='transaction', field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='loans.loantransaction')), migrations.AddIndex(model_name='loantransaction', index=models.Index(fields=['loan', 'transaction_date'], name='loans_loant_loan_id_b17be6_idx')), migrations.AddIndex(model_name='loantransaction', index=models.Index(fields=['transaction_type', 'value_date'], name='loans_loant_transac_7065d9_idx')), migrations.AlterUniqueTogether(name='loanrepaymentschedule', unique_together={('loan', 'installment_number')}), migrations.AddIndex(model_name='loan', index=models.Index(fields=['status', 'next_payment_date'], name='loans_loan_status_9e82d1_idx')), migrations.AddIndex(model_name='loan', index=models.Index(fields=['client', 'status'], name='loans_loan_client__a27993_idx'))]